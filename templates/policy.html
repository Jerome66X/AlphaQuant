{% extends 'base.html' %}

{% block cssfile %}
    <link href="/static/bootstrap/css/bootstrap-datetimepicker.min.css" rel="stylesheet">
    <style>
        body{
            background-color: #f5f5f5;
        }

        .policy_solid {
            border: 1px solid grey;
        }

        #policy_top {
            height: 40px;
        }

        #policy_content {
            height: 570px;
        }

        #policy_left_top {
            height: 40px;
        }

         #policy_editor {
            height: 527px;
        }

        #policy_right_top{
            height: 36px;
        }

        #policy_right_result{
            height: 360px;
        }

        #policy_result_info{
            height: 55px;
        }

        #policy_result_chart{
            height: 305px;
        }

        #policy_log_error{
            height: 170px;
        }

        #policy_ace_log_error{
            height: 125px;
        }

        .policy_input {
            height: 30px;
            width: 15%;
            margin-top: 3px;
            margin-left: 2px;
        }

        .policy_input2 {
            height: 27px;
            width: 30%;
            margin-top: 2px;
            margin-left: 2px;
        }

        .policy_btn {
            height: 30px;
            margin-top: 2px;
        }

    </style>
{% endblock %}

{% block content %}
    <div class="container-fluid">
        <div class="row policy_solid" id="policy_top">
            <div class="col-md-6">
                <span class="glyphicon glyphicon-menu-left " aria-hidden="true" style=" margin-top:2px;"></span>
                <input type="text" id="policyTitle" name="title" class="policy_input2" value="{{ policy.name }}"/>
                <input type="hidden" id="policy_uuid" value="{{ policy.uuid }}"/>
                 <input type="hidden" id="policy_id" value="{{ policy.id }}"/>
            </div>
            <div class="col-md-6">
                <button class="btn pull-right policy_btn" type="button">策略</button>
                <button class="btn pull-right policy_btn" type="button">回测</button>
            </div>
        </div>
        <div class="row policy_solid" id="policy_content">
            <div class="col-md-5 " id="policy_left">
                <div class="row policy_solid" id="policy_left_top">
                    <div class="col-md-12">
                        <button class="btn policy_btn" id="saveBtn" type="button">保存</button>
                        <button class="btn policy_btn" id='buildBtn' type="button">编译运行</button>
                    </div>
                </div>


                <div class="row policy_solid" id="policy_editor">{% if policy.content %}{{ policy.content }}{% else  %}
args=[14,5]

def initialize(self):

        self.__rsi = rsi.RSI(self.feed[self.instrument].getCloseDataSeries(),self.args[0])
        self.__sma = ma.SMA(self.__rsi, self.args[1])



def onBars(self, bars):

        sma= self.__sma[-1]
        if sma is None:
            return

        price = bars[self.instrument].getClose()
        shares=self.getBroker().getShares(self.instrument)

        if price > 1.01*sma:
            self.marketOrder(self.instrument,shares*-1)
            print 'SELL %i'%shares
        if price < 0.9*sma:
            sharesToBuy=int(self.getBroker().getCash()/price)
            self.marketOrder(self.instrument, sharesToBuy)
            print 'BUY %d'%shares
                     {% endif %}
                </div>

            </div>
            <div class="col-md-7" id="policy_right">
                <div id="policy_right_top" class="row policy_solid" style="background-color: #FFFFE0">
                    <div class="col-md-10">
                        <form class="form-inline">
                            <div class="form-group">
                                <input type="text" id="company" class="policy_input form-control " style="width: 70px" value="orcl"/>

                                <input type='text' id="beginTime" class="form-control policy_input datetimepicker" style="width: 85px"
                                       readonly value="2012-02-01"/>
                                到
                                <input type='text' id="endTime" class=" form-control policy_input datetimepicker" style="width: 85px"
                                       readonly value="2016-02-01"/>

                                    &#165;
                                    <input type="text" id="money" class="form-control policy_input"  style="width: 70px" value="30000"/>

                                    <select id='rate' class="form-control policy_input ">
                                        <option value="day" selected="selected">每天</option>
                                        <option value="minute">分钟</option>
                                    </select>
                            </div>
                        </form>


                    </div>
                    <div class="col-md-2">
                        <button class="btn btn-primary pull-right policy_btn" type="button">运行回测</button>
                    </div>
                </div>
                <div id="policy_right_result" class="row policy_solid">
                    <div class="col-md-12">
                        <div id="policy_result_info" class="row" >
                           <table class="table-condensed"  >
                    <tr>
                        <th>策略收益</th>
                        <th>基准收益</th>
                        <th>Alpha</th>
                        <th>Beta</th>
                        <th>Sharpe</th>
                        <th>最大回撤</th>
                    </tr>
                    <tr>
                        <td id="strategy_return">--</td>
                        <td id="basic_return">--</td>
                        <td id="alpha">--</td>
                        <td id="beta">--</td>
                        <td id="sharp">--</td>
                        <td id="maxdown">--</td>
                    </tr>
                </table>
                        </div>
                        <div id="policy_result_chart" class="row policy_solid">

                        </div>
                    </div>
                </div>
                <div id = 'policy_log_error'class="row policy_solid">
                   <ul class="nav nav-tabs" id="nav-tabs">
                        <li class="active">
                            <a id="daily-logs-link" href="#" data-toggle="tab">日志</a>
                        </li>
                        <li>
                            <a id="daily-error-tab-link" href="#" data-toggle="tab">错误</a>
                        </li>
                    </ul>
                    <div id="policy_ace_log_error">
                        <div id="policy_log"></div>
                        <div id="policy_error" style="display:none"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block jsfile %}
    <script type="text/javascript" src="/static/plugin/ace/ace.js" charset="utf-8"></script>
    <script type="text/javascript" src="/static/plugin/ace/theme-twilight.js" charset="utf-8"></script>
    <script type="text/javascript" src="/static/plugin/ace/mode-python.js" charset="utf-8"></script>
    <script type="text/javascript" src="/static/bootstrap//js/bootstrap-datetimepicker.min.js" charset="utf-8"></script>
    <script type="text/javascript" src="/static/bootstrap/js/bootstrap-datetimepicker.zh-CN.js" charset="utf-8"></script>
    <script type="text/javascript" src="/static/js/highcharts.js"></script>
    <script type="text/javascript" src="/static/js/policy.js" charset="utf-8"></script>

{% endblock %}